<ion-content [fullscreen]="true">
  <ion-content>
    <div class="Customer">
      <div class="container_data">
        <ion-card-content>
          <div class="dekstop-menu">
            <ion-card-header>
              <ion-row lines="none">
                <ion-icon (click)="goBack()" class="back" name="arrow-back"></ion-icon>
                <ion-title style="text-align: center;">Add Item</ion-title>
                <div class="custom-primary">
                  <ion-button size="small" [routerLink]="['/viewitem']" id="open-loading5">View Item</ion-button>
                  <ion-loading class="custom-loading" trigger="open-loading5" message="Item Showing ..."
                    [duration]="1000"></ion-loading>

                </div>
              </ion-row>
            </ion-card-header>
          </div>
          <ion-grid>
            <form [formGroup]="myform" (ngSubmit)="onSubmit()">
              <ion-row>

                <ion-col size="12" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input #firstInvalidInput [(ngModel)]="itemCode" formControlName="itemCode" name="itemCode"
                      type="text" label=" Item code :" label-placement="floating" fill="outline"></ion-input>

                  </ion-row>
                </ion-col>

                <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="itemDesc" formControlName="itemDesc" name="itemDesc" type="text"
                      label=" Item Description :" label-placement="floating" fill="outline">
                    </ion-input>
                  </ion-row>
                </ion-col>

                <ion-col size="6" size-lg="2.5" size-md="6" size-sm="6">

                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="--- HSN ---" label-placement="floating" fill="outline" [(ngModel)]="hsnname"
                    formControlName="hsnname" name="hsnname">
                    <!-- <ion-select-option value="">  --- HSN --- </ion-select-option> Default option with value 0 -->
                    <ion-select-option *ngFor="let hsnname of hsnname$ | async" [value]="hsnname.hsnid">
                      {{ hsnname.hsnname }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col class="custom-primary" size-lg="0.5" size-md="2" size-sm="2" size="2">
                  <ion-button id="left-start"><ion-icon name="person-add-outline"></ion-icon></ion-button>
                </ion-col>

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="--- Item Type ---" label-placement="floating" fill="outline" [(ngModel)]="itemtypename"
                    formControlName="itemtypename" name="itemtypename">
                    <!-- <ion-select-option value="">  --- Item Type --- </ion-select-option> Default option with value 0 -->
                    <ion-select-option *ngFor="let itemtypename of itemtypename$ | async"
                      [value]="itemtypename.itemtypeid">
                      {{ itemtypename.itemtypename }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="--- GST Type ---" label-placement="floating" fill="outline" [(ngModel)]="selectGst"
                    formControlName="selectGst" name="selectGst">
                    <!-- <ion-select-option value="0">  --- GST Type --- </ion-select-option> Default option with value 0 -->
                    <ion-select-option *ngFor="let gsttype of selectGst$ | async" [value]="gsttype.gstid">
                      {{ gsttype.gstname }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col size="6" size-lg="2.5" size-md="6" size-sm="6">
                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="--- Unit Name ---" label-placement="floating" fill="outline" [(ngModel)]="unitname"
                    formControlName="unitname" name="unitname">
                    <!-- <ion-select-option value="0">  --- Unit Name --- </ion-select-option> -->
                    <ion-select-option *ngFor="let unitnames of unitname$ | async" [value]="unitnames.unitid">
                      {{ unitnames.unitname }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col class="custom-primary" size-lg="0.5" size-md="2" size-sm="2" size="2">
                  <ion-button id="unit"><ion-icon name="person-add-outline"></ion-icon></ion-button>
                </ion-col>

                <ion-col size="6" size-lg="2.5" size-md="6" size-sm="6">
                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="--- Item Group ---" label-placement="floating" fill="outline" [(ngModel)]="selectItemGroup"
                    formControlName="selectItemGroup" name="selectItemGroup">
                    <!-- <ion-select-option value="0">  --- Item Group --- </ion-select-option> Default option with value 0 -->
                    <ion-select-option *ngFor="let itemgroup of itemgroups$  | async" [value]="itemgroup.itemgroupid">
                      {{ itemgroup.itemgroupname }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col class="custom-primary" size-lg="0.5" size-md="2" size-sm="2" size="2">
                  <ion-button id="group"><ion-icon name="person-add-outline"></ion-icon></ion-button>
                </ion-col>

              </ion-row>
              <ion-row style="margin-top: 4px;">

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="mrp" formControlName="mrp" name="MRP" type="number" label=" MRP:"
                      label-placement="floating" fill="outline"></ion-input>
                  </ion-row>

                </ion-col>
                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="salerate" formControlName="salerate" name="salerate" type="number"
                      label="Sale Rate :" label-placement="floating" fill="outline"></ion-input>
                  </ion-row>
                </ion-col>
                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="purchaserate" formControlName="purchaserate" name="purchaserate"
                      type="number" label="Purchase Rate :" label-placement="floating" fill="outline"></ion-input>
                  </ion-row>
                </ion-col>

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="basicrate" formControlName="basicrate" name="basicrate" type="number"
                      label=" Basic Rate:" label-placement="floating" fill="outline"></ion-input>
                  </ion-row>
                </ion-col>

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                    label="---Stock Type---" label-placement="floating" fill="outline" [(ngModel)]="stocktypename"
                    formControlName="stocktypename" name="stocktypename">
                    <ion-select-option value=""> --- Stock Type --- </ion-select-option> Default option with value 0
                    <ion-select-option *ngFor="let stocktypename of stocktypename$ | async"
                      [value]="stocktypename.stocktypeid">
                      {{ stocktypename.stocktypename }}
                    </ion-select-option>
                  </ion-select>
                </ion-col>

                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="openingbalance" formControlName="openingbalance" name="opening_balance"
                      type="text" label=" Opening Balance :" label-placement="floating" fill="outline"></ion-input>
                  </ion-row>

                </ion-col>
                <ion-col size="6" size-lg="3" size-md="6" size-sm="6">
                  <ion-row>
                    <ion-input [(ngModel)]="closingbalance" formControlName="closingbalance" name="closing_balance"
                      type="text" label=" Closing Balance :" label-placement="floating" fill="outline"></ion-input>
                  </ion-row>
                </ion-col>

              </ion-row>

              <ion-row style=" border: 2px solid lightblue; margin-top: 20px;">
                <ion-toolbar>
                  <ion-segment style="border-bottom: 2px solid lightblue;" name="type"
                    [ngModelOptions]="{standalone: true}" [(ngModel)]="type" (ionChange)="segmentChanged($event)"
                    scrollable>
                    <ion-segment-button style="border-right: 2px solid lightblue; background: fff; color: #000000;"
                      value="all">
                      <ion-label>Attribute</ion-label>
                    </ion-segment-button>
                    <ion-segment-button style="border-right: 2px solid lightblue;background: fff; color: #000000;"
                      value="Image">
                      <ion-label>Image</ion-label>
                    </ion-segment-button>
                    <ion-segment-button style="border-right: 2px solid lightblue; background: #fff; color: #000000;"
                      value="Barcode">
                      <ion-label>Barcode </ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="Other"
                      style="border-right: 2px solid lightblue; background: #fff; color: #000000;">
                      <ion-label>Other Details</ion-label>
                    </ion-segment-button>
                  </ion-segment>
                </ion-toolbar>

                <ng-container [ngSwitch]="type">
                  <div style="width: 100%; margin-bottom: 30px;" *ngSwitchCase="'all'">
                    <ion-row *ngFor="let attributeKey of getAttributeKeys(); let i = index">
                      <ion-col size="12" size-lg="3" size-md="3" size-sm="6">
                        <ion-row>
                          <ion-select class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
                            label="---Select Attribute--- " label-placement="floating" fill="outline"
                            [(ngModel)]="attributes[attributeKey]" formControlName="{{ attributeKey }}"
                            name="{{ attributeKey }}" (ionChange)="onAttributeChange()">
                            <ion-select-option value="">Select Attribute</ion-select-option>
                            <ion-select-option *ngFor="let attributename of attname$ | async; let i = index">{{
                              attributename.attname }}</ion-select-option>
                          </ion-select>
                        </ion-row>
                      </ion-col>
                    </ion-row>

                    <ion-button (click)="addAttribute()">Add New Attribute</ion-button>
                    <ion-row class="headinglabel">
                      <ion-label>Fixed Attributes :</ion-label>
                    </ion-row>

                    <ion-row style="margin-top: 10px;">
                      <ion-row>
                        <ion-col>
                          <ion-input [(ngModel)]="labelname" formControlName="labelname" name="labelname" type="text"
                            label="Label Name :" label-placement="floating" fill="outline"></ion-input>
                        </ion-col>
                        <ion-col>
                          <ion-input [(ngModel)]="valuename" formControlName="valuename" name="valuename" type="text"
                            label=" Value :" label-placement="floating" fill="outline"></ion-input>
                        </ion-col>
                      </ion-row>
                    </ion-row>
                  </div>

                  <div style="width: 100%;height: 100%; margin: 0 auto;" *ngSwitchCase="'Image'">

                    <ion-row>
                      <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                        <div class="images">
                          <input class="file" type="file" formControlName="files" (change)="onFileSelected($event)"
                            accept="image/*" />
                          <img [src]="selectedImage" class="image_url" *ngIf="selectedImage" alt="Selected Image" />
                        </div>
                      </ion-col>

                      <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                        <div></div>
                      </ion-col>


                    </ion-row>
                  </div>

                  <div style="width: 100%; margin: 0 auto;" *ngSwitchCase="'Barcode'">
                    <ion-row style="margin-bottom: 10px;">
                      <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                        <ion-row>
                          <ion-input name="barcode" formControlName="barcode" [(ngModel)]="barcode" type="number"
                            label=" Barcode :" label-placement="floating" fill="outline"></ion-input>
                        </ion-row>
                      </ion-col>
                    </ion-row>
                  </div>

                  <div style="width: 100%; margin: 10px auto;" *ngSwitchCase="'Other'">

                    <ion-row class="headinglabel">
                      <ion-label>Quantity Levels</ion-label>
                    </ion-row>

                    <ion-row>

                      <ion-col size="12" size-lg="4" size-md="4" size-sm="4">
                        <ion-row>
                          <ion-input name="minimum" formControlName="minimum" [(ngModel)]="minimum" type="number"
                            label="Minimum :" label-placement="floating" fill="outline"></ion-input>
                        </ion-row>
                      </ion-col>
                      <ion-col size="12" size-lg="4" size-md="4" size-sm="4">
                        <ion-row>
                          <ion-input name="maximum" formControlName="maximum" [(ngModel)]="maximum" type="number"
                            label="Maximum :" label-placement="floating" fill="outline"></ion-input>
                        </ion-row>
                      </ion-col>

                      <ion-col size="12" size-lg="4" size-md="4" size-sm="4">
                        <ion-row>
                          <ion-input name="reorder" formControlName="reorder" [(ngModel)]="reorder" type="text"
                            label="Re-order :" label-placement="floating" fill="outline"></ion-input>
                        </ion-row>
                      </ion-col>

                    </ion-row>



                    <!--  <div style="margin-top: 30px; border:  0.5px solid grey; width: 100%;"></div>

                  <ion-row class="headinglabel">
                    <ion-label>Dimension & Weight</ion-label>
                  </ion-row>

                  <ion-row>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input name="dime_nsion" formControlName="dimension" [(ngModel)]="dimension"
                          type="text"  label="Dimension :" label-placement="floating"
                          fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input name="wei_ght" formControlName="weight" [(ngModel)]="weight"
                          type="text" label="Weight :" label-placement="floating" fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                  </ion-row>

                  <ion-row>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input name="brand_name" formControlName="brandname" [(ngModel)]="brandname"
                          type="text" label="Brand Name :" label-placement="floating"
                          fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input name="model_name" formControlName="modelname" [(ngModel)]="modelname"
                           type="text" label=" Model name :" label-placement="floating"
                          fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                  </ion-row>

                  <ion-row>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <select name="categ_ory" formControlName="category" [(ngModel)]="category">
                        <option value="Category">--Select Category--</option>
                        <option value="">Non Stock(Asset)</option>
                        <option value="">Non Stock(Expense)</option>
                        <option value="">Service</option>
                        <option value="">Capital</option>
                      </select>
                    </ion-col>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input [(ngModel)]="weightunit" formControlName="weightunit" name="weight_unit" type="text"
                          label="Unit of Weigth :" label-placement="floating" fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                  </ion-row>

                  <ion-row style="margin-bottom: 20px;">

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input [(ngModel)]="relailprofit" formControlName="relailprofit" name="relail_profit" type="text"
                          label="Retailer Profit % :" label-placement="floating" fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                    <ion-col size="12" size-lg="6" size-md="6" size-sm="6">
                      <ion-row>
                        <ion-input [(ngModel)]="delarprofit" formControlName="delarprofit" name="delar_profit" type="text"
                          label="Delar Profit % : " label-placement="floating" fill="outline"></ion-input>
                      </ion-row>
                    </ion-col>

                  </ion-row> -->
                  </div>
                </ng-container>

              </ion-row>
              <ion-row class="custom-primary" style="justify-content: right;margin-top: 20px;">
                <ion-button id="open-loading" (click)="onNew()">New</ion-button>
                <ion-loading class="custom-loading" trigger="open-loading" message="Cleaning..."
                  [duration]="1000"></ion-loading>
                <ion-button type="submit" id="open-loading1">Save</ion-button>

                <ion-button id="open-loading4" (click)="onButtonClick()">Close</ion-button>
                <ion-loading class="custom-loading" trigger="open-loading4" message="Customer Closing..."
                  [duration]="1000"></ion-loading>

              </ion-row>
            </form>
          </ion-grid>
        </ion-card-content>
      </div>
    </div>
  </ion-content>
</ion-content>

<ion-popover trigger="left-start" side="bottom" alignment="end">

  <ng-template style="margin-right: 200px;">
    <div style="margin: 10px;">
      <ion-content class="ion-padding Customer ">
        <ion-row style="justify-content: center;margin-bottom: 10px;">
          <ion-label class="executive">Add HSN</ion-label>
        </ion-row>
        <form [formGroup]="hsnpop" (ngSubmit)="OnHsnSubmit()">
          <ion-row>

            <ion-col size="6" size-lg="6" size-md="6" size-sm="6">
              <ion-row>
                <ion-input [(ngModel)]="hsncode" formControlName="hsncode" name="hsncode" type="text" label="HSN Code :"
                  label-placement="floating" fill="outline"></ion-input>

              </ion-row>
            </ion-col>
            <ion-col size="6" size-lg="6" size-md="6" size-sm="6">
              <ion-row>
                <ion-input [(ngModel)]="unit" formControlName="unit" name="unit" type="text" label="Unit :"
                  label-placement="floating" fill="outline"></ion-input>

              </ion-row>
            </ion-col>
          </ion-row>

          <ion-row style="float: right;margin-top: 23px;">
            <ion-button type="submit">Save</ion-button>
            <ion-button (click)="closePopover()">Close</ion-button>
          </ion-row>
        </form>
      </ion-content>
    </div>
  </ng-template>

</ion-popover>


<ion-popover  trigger="unit" side="bottom" alignment="end">
  <ng-template style="margin-right: 200px;">
    <div style="margin: 10px;">
      <ion-content class="ion-padding Customer ">
        <ion-row style="justify-content: center;margin-bottom: 10px;">
          <ion-label class="executive">Add Unit</ion-label>
        </ion-row>
        <form [formGroup]="unitpop" (ngSubmit)="OnUnitSubmit()">
          <ion-row>
            <ion-col size-lg="6" size-md="6" size-sm="6" size="6">
              <ion-row>
                <ion-input [(ngModel)]="unit_name" formControlName="unit_name" name="unit_name" type="text"
                  label="Unit Name :" label-placement="floating" fill="outline"></ion-input>
              </ion-row>
            </ion-col>
            <ion-col size-lg="6" size-md="6" size-sm="6" size="6">
              <ion-row>
                <ion-input [(ngModel)]="short_name" formControlName="short_name" name="short_name" type="text"
                  label="Symbol/ Short Name :" label-placement="floating" fill="outline"></ion-input>
              </ion-row>
            </ion-col>

          </ion-row>

          <ion-row style="float: right;margin-top: 23px;">
            <ion-button type="submit">Save</ion-button>
            <ion-button (click)="closePopover()">Close</ion-button>
          </ion-row>
        </form>
      </ion-content>
    </div>
  </ng-template>

</ion-popover>

<ion-popover  trigger="group" side="bottom" alignment="end">
  <ng-template style="margin-right: 200px;">
    <div style="margin: 10px;">
      <ion-content class="ion-padding Customer ">
        <ion-row style="justify-content: center;margin-bottom: 10px;">
          <ion-label class="executive">Add Unit</ion-label>
        </ion-row>
        <form [formGroup]="groupop" (ngSubmit)="OnGroupSubmit()">
          <ion-row>
            <ion-col size-lg="6" size-md="6" size-sm="6" size="6">
              <ion-row>
                <ion-input #firstInvalidInput [(ngModel)]="itemgroupname" formControlName="itemgroupname" name="itemgroupname" type="text" label="Item Group Name :" label-placement="floating"
                  fill="outline"></ion-input>
              </ion-row>
            </ion-col>
            
            <ion-col size-lg="6" size-md="6" size-sm="6" size="6">
              <ion-select  class="always-flip" toggleIcon="caret-down-sharp" color="dark" interface="popover"
              label="---Parent Group---" label-placement="floating" fill="outline"   [(ngModel)]="parentgroup" formControlName="parentgroup"  name="parentgroup">
                <!-- <option value="0">  --- Parent Group --- </option> Default option with value 0  -->
               
                <ion-select-option *ngFor="let itemgroup of itemgroups$  | async" [value]="itemgroup.itemgroupid">
                  {{ itemgroup.itemgroupname }}
                </ion-select-option>
              </ion-select>
             
            </ion-col>

          </ion-row>

          <ion-row style="float: right;margin-top: 23px;">
            <ion-button type="submit">Save</ion-button>
            <ion-button (click)="closePopover()">Close</ion-button>
          </ion-row>
        </form>
      </ion-content>
    </div>
  </ng-template>

</ion-popover>


